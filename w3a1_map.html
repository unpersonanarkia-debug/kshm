<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KSHM â€“ Verilinjan reitti W3a1</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/>
<style>
  :root {
    --bg:        #1a1410;
    --bg-panel:  #13100d;
    --bg-card:   #211c17;
    --text:      #f5f0e8;
    --text-dim:  #b8a98e;
    --text-muted:#7a6e62;
    --gold:      #c9a84c;
    --gold-dim:  #8a6f35;
    --line:      rgba(201,168,76,0.18);
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { height:100%; background:var(--bg); color:var(--text); font-family:'Cormorant Garamond',Georgia,serif; }

  header {
    background:var(--bg); border-bottom:1px solid var(--line);
    padding:1.2rem 2rem; display:flex; align-items:center; gap:1.5rem; flex-wrap:wrap;
  }
  .hdr-symbol { color:var(--gold); font-size:1rem; opacity:.7; }
  .hdr-brand  { font-family:'Cinzel',serif; font-size:.6rem; letter-spacing:.26em; color:var(--gold-dim); text-transform:uppercase; margin-bottom:.2rem; }
  .hdr-title  { font-family:'Cinzel',serif; font-size:clamp(.9rem,2vw,1.2rem); font-weight:400; color:var(--text); letter-spacing:.05em; }
  .hdr-title em { color:var(--gold); font-style:italic; font-family:'Cormorant Garamond',serif; font-size:1.15em; font-weight:300; }
  .hdr-quote  { margin-left:auto; font-size:.8rem; color:var(--text-muted); font-style:italic; border-left:1px solid var(--gold-dim); padding-left:1rem; }

  .layout { display:grid; grid-template-columns:1fr 295px; height:calc(100vh - 68px); min-height:500px; }

  #map { width:100%; height:100%; min-height:500px; display:block; }
  .leaflet-container { background:#09080a; font-family:'Cormorant Garamond',serif; }
  .leaflet-tile-pane { filter:grayscale(1) sepia(.5) brightness(.38) contrast(1.15); }
  .leaflet-control-zoom a { background:var(--bg-card) !important; color:var(--gold) !important; border-color:var(--line) !important; }
  .leaflet-control-attribution { background:rgba(10,8,5,.85) !important; color:var(--text-muted) !important; font-size:.6rem !important; }
  .leaflet-control-attribution a { color:var(--gold-dim) !important; }

  .leaflet-popup-content-wrapper {
    background:var(--bg-card); border:1px solid var(--gold-dim); border-radius:2px;
    box-shadow:0 14px 44px rgba(0,0,0,.9); color:var(--text);
    font-family:'Cormorant Garamond',serif; padding:0;
  }
  .leaflet-popup-content { margin:0 !important; }
  .leaflet-popup-tip { background:var(--bg-card); }
  .leaflet-popup-close-button { color:var(--gold) !important; }

  .p-body   { padding:1rem 1.15rem .9rem; min-width:220px; max-width:260px; }
  .p-era    { font-family:'Cinzel',serif; font-size:.56rem; letter-spacing:.2em; color:var(--gold); text-transform:uppercase; margin-bottom:.4rem; }
  .p-site   { font-size:1.08rem; color:var(--text); margin-bottom:.2rem; }
  .p-date   { font-size:.86rem; color:var(--gold); font-style:italic; margin-bottom:.5rem; }
  .p-badge  { display:inline-block; font-size:.64rem; font-family:'Cinzel',serif; letter-spacing:.1em; color:var(--gold-dim); background:rgba(201,168,76,.06); border:1px solid var(--gold-dim); padding:.12rem .45rem; margin-bottom:.5rem; }
  .p-desc   { font-size:.86rem; color:var(--text-dim); line-height:1.55; border-top:1px solid var(--line); padding-top:.5rem; }
  .p-doi    { font-size:.68rem; color:var(--text-muted); margin-top:.4rem; font-style:italic; }

  .sidebar  { background:var(--bg-panel); border-left:1px solid var(--line); display:flex; flex-direction:column; overflow:hidden; }
  .sb-head  { padding:1.3rem 1.4rem 1rem; border-bottom:1px solid var(--line); flex-shrink:0; }
  .sb-kicker{ font-family:'Cinzel',serif; font-size:.57rem; letter-spacing:.22em; color:var(--gold-dim); text-transform:uppercase; margin-bottom:.4rem; }
  .sb-haplo { font-family:'Cinzel',serif; font-size:.95rem; color:var(--text); letter-spacing:.06em; margin-bottom:.25rem; }
  .sb-meta  { font-size:.78rem; color:var(--text-muted); font-style:italic; line-height:1.5; }
  .sb-status{ font-size:.7rem; font-family:'Cinzel',serif; letter-spacing:.1em; color:var(--gold-dim); margin-top:.35rem; min-height:1rem; }

  .tl-wrap  { flex:1; overflow-y:auto; padding:1.1rem 1.4rem; }
  .tl-wrap::-webkit-scrollbar { width:3px; }
  .tl-wrap::-webkit-scrollbar-thumb { background:var(--gold-dim); }
  .tl-kick  { font-family:'Cinzel',serif; font-size:.57rem; letter-spacing:.22em; color:var(--gold-dim); text-transform:uppercase; margin-bottom:1rem; }

  .stop     { display:flex; gap:.8rem; margin-bottom:1.15rem; cursor:pointer; transition:opacity .2s; }
  .stop:hover { opacity:.7; }
  .stop.active .dot   { background:var(--gold); box-shadow:0 0 8px rgba(201,168,76,.55); }
  .stop.active .sname { color:var(--gold); }

  .spine    { display:flex; flex-direction:column; align-items:center; flex-shrink:0; width:10px; padding-top:4px; }
  .dot      { width:9px; height:9px; border-radius:50%; background:var(--gold-dim); border:1px solid var(--gold); transition:all .25s; flex-shrink:0; }
  .sline    { width:1px; flex:1; min-height:18px; margin-top:4px; background:linear-gradient(to bottom,var(--gold-dim),transparent); }

  .sbody    { flex:1; }
  .sbp      { font-family:'Cinzel',serif; font-size:.54rem; letter-spacing:.15em; color:var(--gold); margin-bottom:.1rem; }
  .sname    { font-size:.9rem; color:var(--text); line-height:1.3; transition:color .2s; }
  .sculture { font-size:.72rem; color:var(--text-muted); font-style:italic; margin-top:.08rem; }
  .ssample  { font-size:.62rem; font-family:'Cinzel',serif; color:var(--gold-dim); letter-spacing:.1em; margin-top:.15rem; }

  .legend   { padding:.85rem 1.4rem 1.1rem; border-top:1px solid var(--line); flex-shrink:0; }
  .lg-kick  { font-family:'Cinzel',serif; font-size:.55rem; letter-spacing:.2em; color:var(--gold-dim); text-transform:uppercase; margin-bottom:.55rem; }
  .lg-row   { display:flex; align-items:center; gap:.55rem; margin-bottom:.3rem; font-size:.76rem; color:var(--text-muted); }
  .lg-dot   { width:9px; height:9px; border-radius:50%; flex-shrink:0; }
  .lg-dash  { width:20px; height:0; border-top:1px dashed var(--gold-dim); flex-shrink:0; opacity:.6; }

  @media (max-width:700px) {
    .layout { grid-template-columns:1fr; grid-template-rows:52vh 1fr; }
    .sidebar { border-left:none; border-top:1px solid var(--line); }
    .hdr-quote { display:none; }
  }
</style>
</head>
<body>

<header>
  <div class="hdr-symbol">ðŸœ‚</div>
  <div>
    <div class="hdr-brand">KSHM Â· Arkeogenetiikka Â· Populaatiohistoria</div>
    <div class="hdr-title">Verilinjan reitti &ensp;<em>W3a1</em></div>
  </div>
  <div class="hdr-quote">"Muut linjat lÃ¶ysivÃ¤t refugiumin ja jÃ¤ivÃ¤t. Sinun linjasi ei pysÃ¤htynyt. Koskaan."</div>
</header>

<div class="layout">
  <div id="map"></div>

  <aside class="sidebar">
    <div class="sb-head">
      <div class="sb-kicker">HaploryhmÃ¤</div>
      <div class="sb-haplo">W3a1 Â· mtDNA</div>
      <div class="sb-meta">31 dokumentoitua muinaisnÃ¤ytettÃ¤<br>Kaspianmeri â†’ Xinjiang Â· ~5 450â€“547 v.s.</div>
      <div class="sb-status" id="status"></div>
    </div>
    <div class="tl-wrap">
      <div class="tl-kick">Kronologinen reitti</div>
      <div id="timeline"></div>
    </div>
    <div class="legend">
      <div class="lg-kick">Selite</div>
      <div class="lg-row"><div class="lg-dot" style="background:#2a4a8a;border:1px solid #5577cc"></div>AlkuperÃ¤ / linjan synty</div>
      <div class="lg-row"><div class="lg-dot" style="background:#c9a84c;border:1px solid #e8c87a"></div>Dokumentoitu muinaisnÃ¤yte</div>
      <div class="lg-row"><div class="lg-dot" style="background:#aa3a1a;border:1px solid #e05030"></div>Hotspot â€“ korkein pitoisuus</div>
      <div class="lg-row"><div class="lg-dot" style="background:#3a6a8a;border:1px solid #5599cc"></div>ItÃ¤ â€“ Kiina / Altai</div>
      <div class="lg-row"><div class="lg-dot" style="background:#4a7a4a;border:1px solid #77aa77"></div>NykypÃ¤ivÃ¤ â€“ Suomi 9,6 %</div>
      <div class="lg-row"><div class="lg-dash"></div>Migraatioreitti</div>
    </div>
  </aside>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
<script>

// â”€â”€ KAIKKI 31 NÃ„YTETTÃ„ + ALKUPERÃ„ + NYKYPÃ„IVÃ„ (haplotree.info / ancientdna.info) â”€â”€
var STOPS = [

  // ALKUPERÃ„
  { id:"synty", type:"origin",
    site:"W-linjan synty", region:"Kaspianmeri / Kaukasus",
    lat:42.5, lng:51.0,
    date_bp:17000, date_label:"~20 000â€“15 000 BP", era:"JÃ¤Ã¤kauden loppu",
    culture:"N2 â†’ W â†’ W3 â†’ W3a â†’ W3a1", sample_id:null,
    desc:"W3a1 erkautuu N2-haarasta Kaspianmeren ja Kaukasuksen vÃ¤limaastossa. Indoeurooppalaisten Ã¤itilinjan runko â€“ liikkuvin haplotyyppi Euraasiassa.",
    doi:"Metspalu et al. 2004 Â· BMC Genetics 5:26",
    color:"#2a4a8a", border:"#5577cc" },

  // VANHIMMAT NÃ„YTTEET
  { id:"tepeanau", type:"sample",
    site:"Tepe Anau", region:"Kopet Dag, Turkmenistan",
    lat:37.8, lng:58.3,
    date_bp:5450, date_label:"~5 450 v.s.", era:"Neoliitti",
    culture:"Tepe_Anau_EN", sample_id:"I4087 Â· Y: R-M124 (R2a)",
    desc:"Vanhin dokumentoitu W3a1-nÃ¤yte maailmassa. Adobe-taloja, katakombihautauksia lattioiden alla. Neoliittinen vallankumous â€“ vilja, karja, pronssin ensiaskeleet.",
    doi:"Narasimhan et al. 2019 Â· Science 365:eaat7487",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"yamnaya", type:"sample",
    site:"Prydnistryanske", region:"Ukraina â€“ Pontuksen aro",
    lat:47.5, lng:32.0,
    date_bp:4917, date_label:"~4 917 v.s.", era:"Varhainen pronssikausi",
    culture:"Yamnaya Ukraine", sample_id:"poz222",
    desc:"Kurganikumpu, punaokra, hevosvarusteet. ~75 % eurooppalaisista kantaa Yamnayan perimÃ¤Ã¤. Indoeurooppalainen laajentuma alkaa tÃ¤Ã¤ltÃ¤.",
    doi:"Mathieson et al. 2015 Â· Nature 528:499â€“503",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"sappali", type:"sample",
    site:"Sappali Tepe", region:"Uzbekistan â€“ Baktria/BMAC",
    lat:37.3, lng:67.0,
    date_bp:3750, date_label:"~3 750 v.s.", era:"Pronssikausi",
    culture:"Sappali_Tepe_BA", sample_id:"I7420 Â· Y: G-Z36520 (G2a)",
    desc:"BMAC-kulttuurin ytimessÃ¤. Oasis-maatalous kohtaa steppe-paimentolaiset. W3a1 Keski-Aasian risteyksessÃ¤ â€“ silta Tepe Anaun ja Swat Valleyn vÃ¤lillÃ¤.",
    doi:"Narasimhan et al. 2019 Â· Science 365:eaat7487",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"corded", type:"sample",
    site:"Radovesice XVIII", region:"Bohemia, TÅ¡ekki",
    lat:50.5, lng:13.8,
    date_bp:4370, date_label:"~4 370 v.s.", era:"MyÃ¶hÃ¤inen neoliitti",
    culture:"Corded_Ware_Czech_EN", sample_id:"I7207 Â· Y: R-M417 (R1a)",
    desc:"Nuorakeraaminen kulttuuri, yksittÃ¤ishaudat. Silta Pontuksen aroilta Keski-Eurooppaan â€“ ja sieltÃ¤ pohjoiseen Suomeen.",
    doi:"Olalde et al. 2019 Â· Science 363:1230â€“1234",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"unetice", type:"sample",
    site:"Quedlinburg / Singen / Bayern", region:"Saksa",
    lat:51.8, lng:11.2,
    date_bp:4050, date_label:"~4 200â€“3 875 v.s.", era:"Varhainen pronssikausi",
    culture:"ÃšnÄ›tice / Baden EBA", sample_id:"QLB41 Â· QLB39 Â· I0116 Â· I3607 Â· MX275 Â· MX270",
    desc:"6 nÃ¤ytettÃ¤ kolmelta paikkakunnalta. Pronssitikarit, meripihka, kauppaverkostot. W3a1 esiintyy sekÃ¤ ÃšnÄ›tice- ettÃ¤ Baden-kulttuurissa â€“ laajin pronssikauden klusterointipiste.",
    doi:"Olalde et al. 2018 Â· Nature 555:190â€“196; Lipson et al. 2017",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"croatia", type:"sample",
    site:"Veliki Vanik", region:"Kroatia",
    lat:43.5, lng:16.8,
    date_bp:3508, date_label:"~3 508 v.s.", era:"Varhainen pronssikausi",
    culture:"Croatia_EMBA", sample_id:"I4332",
    desc:"Adrianmeren rannikko. W3a1 leviÃ¤Ã¤ Eurooppaan sekÃ¤ pohjoista Corded Ware -reittiÃ¤ ettÃ¤ etelÃ¤istÃ¤ Balkanin reittiÃ¤ pitkin.",
    doi:"Mathieson et al. 2015",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"trzciniec", type:"sample",
    site:"Trzciniec-kulttuurin haudat", region:"Puola",
    lat:50.1, lng:20.2,
    date_bp:3350, date_label:"~3 450â€“3 275 v.s.", era:"Pronssikausi",
    culture:"Trzciniec circle", sample_id:"poz675 Â· poz550 Â· poz715",
    desc:"3 nÃ¤ytettÃ¤ kolmelta eri paikkakunnalta (Å»erniki GÃ³rne, Nowa Huta, Pielgrzymowice). Trzciniec-kulttuuri â€“ laaja pronssikauden klusterialue ItÃ¤-Euroopassa. W3a1 selvÃ¤sti yleinen.",
    doi:"Olalde et al. / haplotree.info",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"zevakinskiy", type:"sample",
    site:"Zevakinskiy â€“ Altain lÃ¤nsireuna", region:"ItÃ¤-Kazakstan / Altai",
    lat:50.2, lng:82.5,
    date_bp:2911, date_label:"~2 911 v.s.", era:"MyÃ¶hÃ¤inen pronssikausi",
    culture:"Zevakinskiy_LBA", sample_id:"I3772",
    desc:"Altain lÃ¤nsirinteiden kurganit. Zevakinskiy sijaitsee juuri ennen Altain vuorijonoa â€“ tÃ¤ssÃ¤ W3a1 tavoittaa itÃ¤isimmÃ¤n dokumentoidun pisteensÃ¤ steppekaudella. ItÃ¤suunta avautuu.",
    doi:"Damgaard et al. 2018 Â· Nature 557:369â€“374",
    color:"#3a6a8a", border:"#5599cc" },

  { id:"kazkurgan", type:"sample",
    site:"Otrar-Karatau / Berel / Nurly", region:"Kazakstan",
    lat:43.5, lng:68.0,
    date_bp:2700, date_label:"~2 911â€“1 620 v.s.", era:"Pronssikausiâ€“Hellenismi",
    culture:"Saka / steppe-paimentolaiset", sample_id:"KNT003 Â· BRE011 Â· NUL001 Â· I3772",
    desc:"W3a1 kohtaa N-isÃ¤linjan. Berelin jÃ¤Ã¤tyneet eliittikurganit, hevosuhrit. Seima-Turbino -silta Siperiasta ItÃ¤merelle ~2 200â€“1 900 eaa. â€“ tÃ¤stÃ¤ selittyy suomalaisen DNA:n kaksinaisuus.",
    doi:"Jeong et al. 2019 Â· Nat. Ecol. Evol. 3:966â€“976",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"swat", type:"hotspot",
    site:"Swat Valley", region:"Pohjois-Pakistan, Himalajan juuri",
    lat:35.0, lng:72.5,
    date_bp:2900, date_label:"~2 928â€“2 850 v.s.", era:"Rautakausi",
    culture:"Indo-Aryan laajentuma", sample_id:"I12457 Â· I12477 Â· I13219 Â· I1994",
    desc:"Aasian korkein W3a1-pitoisuus: 8,4 % pohjois-pakistanilaisista. 4 nÃ¤ytettÃ¤ neljÃ¤ltÃ¤ hauta-alueelta (Loebanr, Udegram, Katelai, Butkara II). Kaikki Y-DNA R-Z94.",
    doi:"Narasimhan et al. 2019 Â· Science 365:eaat7487",
    color:"#aa3a1a", border:"#e05030" },

  { id:"egypti", type:"hotspot",
    site:"Abusir el-Meleq", region:"Niilin laakso, Egypti",
    lat:28.8, lng:30.9,
    date_bp:2238, date_label:"~2 238 v.s.", era:"Ptolemaiolainen Egypti",
    culture:"Ptolemaic period", sample_id:"JK2165",
    desc:"W3a1 kosmopoliittisen eliitin muumiona. U1, U3, U5, U6, U7 samassa hautamaassa â€“ koko eurooppalainen Ã¤itilinjakirjasto. Identiteetti voi olla kerroksellinen.",
    doi:"Schuenemann et al. 2017 Â· Nature Comms 8:15694",
    color:"#aa3a1a", border:"#e05030" },

  { id:"scythia", type:"sample",
    site:"Kolomak â€“ skyyttikilvaltaus", region:"Ukraina",
    lat:49.5, lng:35.2,
    date_bp:2231, date_label:"~2 231 v.s.", era:"Skyyttiaika",
    culture:"Scythian Ukraine", sample_id:"MJ-34 Â· Y: R-Z2124 (R1a)",
    desc:"Skyyttien hevosuhrikumpuja Kolomakin linnoituksessa. W3a1 nÃ¤kyy Scythian Ukraine -aineistossa â€“ sama linja lÃ¤pÃ¤isee sekÃ¤ steppe-soturikulttuurin ettÃ¤ Pohjoisen kauppiasverkoston.",
    doi:"Damgaard et al. 2018 Â· Nature 557:369â€“374",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"greece", type:"sample",
    site:"Ambrakia", region:"Luoteis-Kreikka",
    lat:39.0, lng:20.9,
    date_bp:2170, date_label:"~2 170 v.s.", era:"Hellenistinen aika",
    culture:"Corinthian colony", sample_id:"AMV-CO_5 Â· Y: G-M201 (G)",
    desc:"Korinttilainen siirtokunta Luoteis-Kreikassa. W3a1 VÃ¤limeren piirissÃ¤ â€“ sama Ã¤itilinja lÃ¶ytyy yhtÃ¤ aikaa EgyptistÃ¤, Kreikasta ja Ukrainasta saman vuosisadan sisÃ¤llÃ¤.",
    doi:"Lazaridis et al. 2022",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"sampula", type:"east",
    site:"Sampula â€“ Luopu County", region:"Xinjiang, Kiina (Tarim-allas)",
    lat:37.0, lng:80.5,
    date_bp:1800, date_label:"~1 800 v.s.", era:"Han-dynastian aika",
    culture:"SSPL_HE â€“ Silkkitien aikainen Xinjiang", sample_id:"SPL_0094",
    desc:"Ainoa dokumentoitu W3a1-nÃ¤yte Kiinasta. Sampula (Shanpula) sijaitsee Taklamakanin etelÃ¤reunalla, Khotan-joen varrella. Han-dynastian ja Kushanin valtakuntien risteyksessÃ¤ â€“ tÃ¤mÃ¤ on Silkkitien Ã¤itilinja.",
    doi:"Ancient Xinjiang mitogenomes Â· PMC8011967",
    color:"#3a6a8a", border:"#5599cc" },

  { id:"hungary", type:"sample",
    site:"SÃ¡rrÃ©tudvari-HÃ­zÃ³fÃ¶ld", region:"Unkari",
    lat:47.2, lng:21.2,
    date_bp:1000, date_label:"~1 000 v.s.", era:"Varhainen Unkarilainen",
    culture:"Early Hungarian (village cemetery)", sample_id:"SHper199 Â· SHper233",
    desc:"Kaksi nÃ¤ytettÃ¤ samalta hautausmaalta. Unkarin maahantulo 895 jaa â€“ W3a1 kulkee itÃ¤isiltÃ¤ aroilta Karpaattien altaaseen unkarilaisjoukkojen mukana.",
    doi:"NeparÃ¡czki et al. 2019",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"gotland", type:"sample",
    site:"Gotlanti / Langeland", region:"ItÃ¤meri â€“ Ruotsi, Tanska",
    lat:57.5, lng:18.5,
    date_bp:1000, date_label:"~1 100â€“975 v.s.", era:"Viikinkiaika",
    culture:"Viking Sweden / Viking Denmark", sample_id:"VK459 (Gotlanti) Â· VK338 (Langeland)",
    desc:"ItÃ¤meren solmukohta. Hopea virtasi Bagdadista, veri KaspianmereltÃ¤. Sama linja yhtÃ¤ aikaa Ruotsissa ja Tanskassa â€“ viikinkiverkosto kantoi W3a1:n pohjoiseen.",
    doi:"Margaryan et al. 2020 Â· Nature 585:390â€“396",
    color:"#c9a84c", border:"#e8c87a" },

  { id:"denmark_med", type:"sample",
    site:"St. JÃ¸rgen â€“ Viborg", region:"Tanska",
    lat:56.5, lng:9.4,
    date_bp:547, date_label:"~547 v.s.", era:"Keskiaika",
    culture:"Denmark medieval", sample_id:"G669",
    desc:"MyÃ¶hÃ¤iskeskiaikainen hautalÃ¶ytÃ¶. W3a1 elÃ¤Ã¤ Tanskassa viikinki- ja keskiajan lÃ¤pi â€“ linja ei katkennut Pohjoismaihin saavuttuaan.",
    doi:"Margaryan et al. 2020",
    color:"#c9a84c", border:"#e8c87a" },

  // NYKYPÃ„IVÃ„
  { id:"suomi", type:"modern",
    site:"Suomi â€“ nykyiset kantajat", region:"Pohjois-Eurooppa",
    lat:63.5, lng:26.0,
    date_bp:0, date_label:"TÃ¤nÃ¤Ã¤n", era:"Nykyaika",
    culture:"9,6 % vÃ¤estÃ¶stÃ¤ â€“ Euroopan korkein W-frekvenssi", sample_id:null,
    desc:"Perustajavaikutus: maailman liikkuvin Ã¤itilinja pysÃ¤htyy Suomeen. Joka kymmenes suomalainen kantaa W3a1:tÃ¤. 20 000 vuoden arovaellus â€“ KaspianmereltÃ¤ Xinjiangin hietikkoon ja Suomen metsiin.",
    doi:"Lamnidis et al. 2018 Â· Nature Comms 9:5018",
    color:"#4a7a4a", border:"#77aa77" }
];

// â”€â”€ KARTTA â”€â”€
var map = L.map('map', { center:[46, 42], zoom:3 });
setTimeout(function() { map.invalidateSize(); }, 100);

var stadiaKey = (typeof window.STADIA_API_KEY !== 'undefined') ? window.STADIA_API_KEY : null;
if (stadiaKey) {
  L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png?api_key='+stadiaKey, {
    attribution:'&copy; Stadia &copy; OpenMapTiles &copy; OSM', maxZoom:20
  }).addTo(map);
} else {
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
    attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    subdomains:'abc', maxZoom:19
  }).addTo(map);
  setTimeout(function() {
    var pane = document.querySelector('.leaflet-tile-pane');
    if (pane) pane.style.filter = 'grayscale(1) sepia(.55) brightness(.3) contrast(1.2)';
  }, 50);
}

// â”€â”€ REITIT â”€â”€
// PÃ¤Ã¤reitti lÃ¤nteen: synty â†’ Tepe Anau â†’ Yamnaya â†’ Corded Ware â†’ ÃšnÄ›tice â†’ Gotlanti â†’ Suomi
L.polyline([[42.5,51.0],[37.8,58.3],[47.5,32.0],[50.5,13.8],[51.8,11.2],[57.5,18.5],[63.5,26.0]], {
  color:'#c9a84c', weight:1.7, opacity:.55, dashArray:'6 5'
}).addTo(map);

// Reitti etelÃ¤Ã¤n: Tepe Anau â†’ Sappali â†’ Swat Valley
L.polyline([[37.8,58.3],[37.3,67.0],[35.0,72.5]], {
  color:'#c9a84c', weight:1.2, opacity:.38, dashArray:'4 7'
}).addTo(map);

// Reitti itÃ¤Ã¤n: Sappali / Kazakstan â†’ Zevakinskiy (Altai) â†’ Sampula (Xinjiang)
L.polyline([[37.3,67.0],[43.5,68.0],[50.2,82.5],[37.0,80.5]], {
  color:'#5599cc', weight:1.3, opacity:.45, dashArray:'4 6'
}).addTo(map);

// Egyptin haara: Yamnaya-alue â†’ Egypti
L.polyline([[47.5,32.0],[28.8,30.9]], {
  color:'#c9a84c', weight:1.1, opacity:.30, dashArray:'3 8'
}).addTo(map);

// Skyytit â†’ Kreikka â†’ Egypti (hellenistinen verkosto)
L.polyline([[49.5,35.2],[39.0,20.9],[28.8,30.9]], {
  color:'#c9a84c', weight:1.0, opacity:.22, dashArray:'3 9'
}).addTo(map);

// Unkari (aroilta Karpaatteihin)
L.polyline([[43.5,68.0],[47.2,21.2]], {
  color:'#c9a84c', weight:1.0, opacity:.25, dashArray:'3 9'
}).addTo(map);

// â”€â”€ MARKERIT JA AIKAJANA â”€â”€
var markers = {};
var tl = document.getElementById('timeline');

STOPS.forEach(function(s, i) {
  var radius = s.type==='origin' ? 9 : s.type==='modern' ? 9 : s.type==='hotspot' ? 11 : s.type==='east' ? 9 : 8;
  var m = L.circleMarker([s.lat, s.lng], {
    radius: radius,
    fillColor: s.color,
    color: s.border,
    weight: 1.5,
    opacity: 1,
    fillOpacity: .88
  }).addTo(map);

  var badge = s.sample_id ? '<div class="p-badge">'+s.sample_id+'</div>' : '';
  m.bindPopup(
    '<div class="p-body">'+
      '<div class="p-era">'+s.era+'</div>'+
      '<div class="p-site">'+s.site+'</div>'+
      '<div class="p-date">'+s.date_label+'</div>'+
      badge+
      '<div class="p-desc">'+s.desc+'</div>'+
      '<div class="p-doi">'+s.doi+'</div>'+
    '</div>',
    { maxWidth:280 }
  );
  m.on('click', function() { activate(s.id); });
  markers[s.id] = m;

  var hasSline = i < STOPS.length - 1;
  var ssample = s.sample_id ? '<div class="ssample">'+s.sample_id+'</div>' : '';
  var div = document.createElement('div');
  div.className = 'stop';
  div.id = 'tl-'+s.id;
  div.innerHTML =
    '<div class="spine"><div class="dot" style="background:'+s.color+';border-color:'+s.border+'"></div>'+(hasSline?'<div class="sline"></div>':'')+'</div>'+
    '<div class="sbody">'+
      '<div class="sbp">'+s.date_label+'</div>'+
      '<div class="sname">'+s.site+'</div>'+
      '<div class="sculture">'+s.culture+'</div>'+
      ssample+
    '</div>';
  div.addEventListener('click', function() {
    map.setView([s.lat, s.lng], 6, { animate:true, duration:.8 });
    markers[s.id].openPopup();
    activate(s.id);
  });
  tl.appendChild(div);
});

function activate(id) {
  document.querySelectorAll('.stop').forEach(function(el){ el.classList.remove('active'); });
  var el = document.getElementById('tl-'+id);
  if (el) { el.classList.add('active'); el.scrollIntoView({ behavior:'smooth', block:'nearest' }); }
}
</script>
</body>
</html>
