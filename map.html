<!DOCTYPE html>
<html lang="fi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>KSHM â€“ Verilinjan reitti H1â€‘T16189C!</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;1,300;1,400&family=Cinzel:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
  :root {
    --bg:        #1a1410;
    --bg-panel:  #13100d;
    --bg-card:   #211c17;
    --text:      #f5f0e8;
    --text-dim:  #b8a98e;
    --text-muted:#7a6e62;
    --gold:      #c9a84c;
    --gold-dim:  #8a6f35;
    --line:      rgba(201,168,76,0.18);
  }

  * { margin:0; padding:0; box-sizing:border-box; }
  html, body { height:100%; background:var(--bg); color:var(--text); font-family:'Cormorant Garamond',Georgia,serif; }

  /* â”€â”€ HEADER â”€â”€ */
  header {
    background: var(--bg);
    border-bottom: 1px solid var(--line);
    padding: 1.2rem 2rem;
    display: flex;
    align-items: center;
    gap: 1.5rem;
    flex-wrap: wrap;
  }

  .hdr-symbol { color:var(--gold); font-size:1rem; opacity:.7; flex-shrink:0; }

  .hdr-brand {
    font-family:'Cinzel',serif;
    font-size:.6rem;
    letter-spacing:.26em;
    color:var(--gold-dim);
    text-transform:uppercase;
    margin-bottom:.2rem;
  }

  .hdr-title {
    font-family:'Cinzel',serif;
    font-size:clamp(.9rem,2vw,1.2rem);
    font-weight:400;
    color:var(--text);
    letter-spacing:.05em;
  }

  .hdr-title em {
    color:var(--gold);
    font-style:italic;
    font-family:'Cormorant Garamond',serif;
    font-size:1.15em;
    font-weight:300;
  }

  .hdr-quote {
    margin-left:auto;
    font-size:.8rem;
    color:var(--text-muted);
    font-style:italic;
    border-left:1px solid var(--gold-dim);
    padding-left:1rem;
  }

  /* â”€â”€ LAYOUT â”€â”€ */
  .layout {
    display:grid;
    grid-template-columns:1fr 295px;
    height:calc(100vh - 68px);
  }

  /* â”€â”€ MAP â”€â”€ */
  #map { width:100%; height:100%; }
  .leaflet-container { background:#09080a; font-family:'Cormorant Garamond',serif; }
  .leaflet-tile-pane { filter:grayscale(1) sepia(.55) brightness(.35) contrast(1.2) hue-rotate(8deg); }

  /* popup */
  .leaflet-popup-content-wrapper {
    background:var(--bg-card);
    border:1px solid var(--gold-dim);
    border-radius:2px;
    box-shadow:0 14px 44px rgba(0,0,0,.9);
    color:var(--text);
    font-family:'Cormorant Garamond',serif;
    padding:0;
  }
  .leaflet-popup-content { margin:0; width:auto !important; }
  .leaflet-popup-tip { background:var(--bg-card); }
  .leaflet-popup-close-button { color:var(--gold) !important; padding:6px 8px !important; font-size:1rem !important; }

  .p-body { padding:1rem 1.15rem .9rem; min-width:220px; max-width:260px; }
  .p-era  { font-family:'Cinzel',serif; font-size:.56rem; letter-spacing:.2em; color:var(--gold); text-transform:uppercase; margin-bottom:.45rem; }
  .p-site { font-size:1.08rem; color:var(--text); line-height:1.3; margin-bottom:.2rem; }
  .p-date { font-size:.86rem; color:var(--gold); font-style:italic; margin-bottom:.5rem; }
  .p-badge {
    display:inline-block;
    font-size:.64rem; font-family:'Cinzel',serif; letter-spacing:.1em;
    color:var(--gold-dim); background:rgba(201,168,76,.06);
    border:1px solid var(--gold-dim); padding:.12rem .45rem; margin-bottom:.55rem;
  }
  .p-desc { font-size:.86rem; color:var(--text-dim); line-height:1.55; border-top:1px solid var(--line); padding-top:.5rem; }
  .p-doi  { font-size:.68rem; color:var(--text-muted); margin-top:.45rem; font-style:italic; }

  /* leaflet controls */
  .leaflet-control-zoom a { background:var(--bg-card) !important; color:var(--gold) !important; border-color:var(--line) !important; }
  .leaflet-control-zoom a:hover { background:var(--bg) !important; }
  .leaflet-control-attribution { background:rgba(10,8,5,.85) !important; color:var(--text-muted) !important; font-size:.6rem !important; }
  .leaflet-control-attribution a { color:var(--gold-dim) !important; }

  /* â”€â”€ SIDEBAR â”€â”€ */
  .sidebar {
    background:var(--bg-panel);
    border-left:1px solid var(--line);
    display:flex;
    flex-direction:column;
    overflow:hidden;
  }

  .sb-head {
    padding:1.3rem 1.4rem 1rem;
    border-bottom:1px solid var(--line);
    flex-shrink:0;
  }

  .sb-kicker { font-family:'Cinzel',serif; font-size:.57rem; letter-spacing:.22em; color:var(--gold-dim); text-transform:uppercase; margin-bottom:.4rem; }
  .sb-haplo  { font-family:'Cinzel',serif; font-size:.95rem; color:var(--text); letter-spacing:.06em; margin-bottom:.25rem; }
  .sb-meta   { font-size:.78rem; color:var(--text-muted); font-style:italic; line-height:1.5; }

  .sb-status {
    font-size:.7rem; font-family:'Cinzel',serif; letter-spacing:.1em;
    color:var(--gold-dim); font-style:italic; margin-top:.35rem;
    min-height:1rem;
    transition:opacity .3s;
  }

  /* timeline */
  .tl-wrap { flex:1; overflow-y:auto; padding:1.1rem 1.4rem; }
  .tl-wrap::-webkit-scrollbar { width:3px; }
  .tl-wrap::-webkit-scrollbar-thumb { background:var(--gold-dim); }

  .tl-kicker { font-family:'Cinzel',serif; font-size:.57rem; letter-spacing:.22em; color:var(--gold-dim); text-transform:uppercase; margin-bottom:1rem; }

  .stop { display:flex; gap:.8rem; margin-bottom:1.15rem; cursor:pointer; transition:opacity .2s; }
  .stop:hover { opacity:.7; }
  .stop.active .dot { background:var(--gold); box-shadow:0 0 8px rgba(201,168,76,.55); }
  .stop.active .sname { color:var(--gold); }

  .spine { display:flex; flex-direction:column; align-items:center; flex-shrink:0; width:10px; padding-top:4px; }
  .dot   { width:9px; height:9px; border-radius:50%; background:var(--gold-dim); border:1px solid var(--gold); transition:all .25s; }
  .sline { width:1px; flex:1; min-height:18px; margin-top:4px; background:linear-gradient(to bottom,var(--gold-dim),transparent); }

  .sbody { flex:1; }
  .sbp    { font-family:'Cinzel',serif; font-size:.54rem; letter-spacing:.15em; color:var(--gold); margin-bottom:.1rem; }
  .sname  { font-size:.9rem; color:var(--text); line-height:1.3; transition:color .2s; }
  .sculture { font-size:.72rem; color:var(--text-muted); font-style:italic; margin-top:.08rem; }
  .ssample  { font-size:.62rem; font-family:'Cinzel',serif; color:var(--gold-dim); letter-spacing:.1em; margin-top:.15rem; }

  /* legend */
  .legend { padding:.85rem 1.4rem 1.1rem; border-top:1px solid var(--line); flex-shrink:0; }
  .lg-kicker { font-family:'Cinzel',serif; font-size:.55rem; letter-spacing:.2em; color:var(--gold-dim); text-transform:uppercase; margin-bottom:.55rem; }
  .lg-row { display:flex; align-items:center; gap:.55rem; margin-bottom:.3rem; font-size:.76rem; color:var(--text-muted); }
  .lg-dot { width:9px; height:9px; border-radius:50%; flex-shrink:0; }
  .lg-dash { width:20px; height:0; border-top:1px dashed var(--gold-dim); flex-shrink:0; opacity:.6; }

  @media (max-width:700px) {
    .layout { grid-template-columns:1fr; grid-template-rows:52vh 1fr; }
    .sidebar { border-left:none; border-top:1px solid var(--line); }
    header { padding:.9rem 1.2rem; gap:.7rem; }
    .hdr-quote { display:none; }
  }
</style>
</head>
<body>

<header>
  <div class="hdr-symbol">ðŸœ‚</div>
  <div>
    <div class="hdr-brand">KSHM Â· Arkeogenetiikka Â· Populaatiohistoria</div>
    <div class="hdr-title">Verilinjan reitti &ensp;<em>H1â€‘T16189C!</em></div>
  </div>
  <div class="hdr-quote">"Veri muistaa reitin. MinÃ¤ olen sen metsÃ¤stÃ¤jÃ¤."</div>
</header>

<div class="layout">
  <div id="map"></div>

  <aside class="sidebar">
    <div class="sb-head">
      <div class="sb-kicker">HaploryhmÃ¤</div>
      <div class="sb-haplo">H1â€‘T16189C! Â· mtDNA</div>
      <div class="sb-meta">TMRCA ~13 000 BP<br>Franco-Cantabrian refugio</div>
      <div class="sb-status" id="status"></div>
    </div>
    <div class="tl-wrap">
      <div class="tl-kicker">Kronologinen reitti</div>
      <div id="timeline"></div>
    </div>
    <div class="legend">
      <div class="lg-kicker">Selite</div>
      <div class="lg-row"><div class="lg-dot" style="background:#2a4a8a;border:1px solid #5577cc"></div>AlkuperÃ¤ / refugio</div>
      <div class="lg-row"><div class="lg-dot" style="background:#c9a84c;border:1px solid #e8c87a"></div>Dokumentoitu muinaisnÃ¤yte</div>
      <div class="lg-row"><div class="lg-dot" style="background:#4a7a4a;border:1px solid #77aa77"></div>Nykyiset kantajat</div>
      <div class="lg-row"><div class="lg-dash"></div>Migraatioreitti (todennÃ¤kÃ¶inen)</div>
    </div>
  </aside>
</div>

<script>
// â”€â”€ STAATTINEN DATA (fallback jos API ei vastaa) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const FALLBACK = [
  { id:"refugio",     type:"origin",  site:"Franco-Cantabrian refugio",  region:"Pohjois-Espanja / Lounais-Ranska", lat:43.3,  lng:-2.5,  date_bp:19000, date_label:"~19 000 BP", era:"JÃ¤Ã¤kausi",         culture:"Paleoliittiset metsÃ¤stÃ¤jÃ¤-kerÃ¤ilijÃ¤t", sample_id:null,        desc:"H1-linjan varhaiset kantajat selvisivÃ¤t jÃ¤Ã¤kauden ankarimmista vuosituhansista Pyreneiden rinteillÃ¤. TÃ¤mÃ¤ on linjan eurooppalainen syntysija.", doi:"Achilli et al. 2004 Â· doi:10.1086/425590",             color:"#2a4a8a", border:"#5577cc" },
  { id:"anatolia",    type:"sample",  site:"BarcÄ±n HÃ¶yÃ¼k",               region:"Marmara-alue, Anatolia",           lat:40.1,  lng:29.2,  date_bp:8200,  date_label:"~8 200 BP",  era:"Neoliitti",        culture:"Anatolian Neolithic (PPNB)",            sample_id:"Barcin_N",  desc:"Varhaiset viljelijÃ¤t Anatoliassa. Savitalot, lattian alle haudatut vainajat. H1-linjan neoliittinen jatkumo lÃ¤nteen pÃ¤in.",              doi:"KÄ±lÄ±nÃ§ et al. 2016 Â· doi:10.1016/j.cub.2016.07.057",   color:"#c9a84c", border:"#e8c87a" },
  { id:"poulnabrone", type:"sample",  site:"Poulnabrone dolmen",         region:"County Clare, Irlanti",            lat:53.05, lng:-9.14, date_bp:5900,  date_label:"~5 900 BP",  era:"Neoliitti",        culture:"Megalithic Neolithic",                  sample_id:"PN05",      desc:"NÃ¤yte PN05 â€“ tÃ¤smÃ¤lleen sama H1â€‘T16189C!â€‘merkki. Poulnabronen dolmen, 33 ihmistÃ¤, Atlantin rannikon megaliittinen huippu.",               doi:"Cassidy et al. 2020 Â· doi:10.1038/s41586-020-2378-6",   color:"#c9a84c", border:"#e8c87a" },
  { id:"maslomecz",   type:"sample",  site:"MasÅ‚omÄ™cz",                  region:"Lublin Voivodeship, Puola",        lat:50.72, lng:23.54, date_bp:1750,  date_label:"~1 750 BP",  era:"Kansainvaellusaika",culture:"Wielbark-kulttuuri (gootit)",            sample_id:"PCA0099",   desc:"Hauta 99. Wielbark-kulttuurin hautakentÃ¤llÃ¤ ei aseita â€“ vain suku, liike ja muisti. Sama hiljainen merkki soluissa.",                    doi:"Stolarek et al. 2019 Â· doi:10.1038/s41598-019-51029-0", color:"#c9a84c", border:"#e8c87a" },
  { id:"gotland",     type:"sample",  site:"Kopparsvik, Gotlanti",       region:"Gotlanti, Ruotsi",                 lat:57.63, lng:18.29, date_bp:1000,  date_label:"~1 000 BP",  era:"Viikinkiaika",     culture:"Viking Age",                            sample_id:"VK51 & VK50",desc:"Kaksi naista. Kopparsvikin hautausmaa oli ItÃ¤meren kaupan solmukohta. Hopea virtasi Bagdadista, veri Anatoliasta.",                       doi:"Margaryan et al. 2020 Â· doi:10.1038/s41586-020-2688-8", color:"#c9a84c", border:"#e8c87a" },
  { id:"finland",     type:"modern",  site:"Suomi â€“ nykyiset kantajat",  region:"Pohjois-Eurooppa",                 lat:63.5,  lng:26.0,  date_bp:0,     date_label:"TÃ¤nÃ¤Ã¤n",     era:"Nykyaika",         culture:"12.29 % (FTDNA 2026)",                 sample_id:null,        desc:"Ketju ei katkennut. H1â€‘T16189C! elÃ¤Ã¤ tÃ¤nÃ¤Ã¤n Suomessa â€“ soluissa, jotka kantavat 13 000 vuoden hiljaisen matkan muistoa.",                 doi:"FTDNA mtDNA Project 2026",                              color:"#4a7a4a", border:"#77aa77" }
];

// â”€â”€ API-KUTSU (kÃ¤ynnistyy automaattisesti, fallback jos epÃ¤onnistuu) â”€â”€
async function loadData() {
  const status = document.getElementById('status');
  try {
    status.textContent = 'Ladataan dataaâ€¦';
    const res = await fetch('/api/research/H1-T16189C!/samples', { signal: AbortSignal.timeout(4000) });
    if (!res.ok) throw new Error('API ei vastannut');
    const json = await res.json();

    // Muunna API-rakenne karttapisteiksi
    const COORD = {
      'PN05':     { lat:53.05, lng:-9.14,  id:'poulnabrone', era:'Neoliitti',         type:'sample', color:'#c9a84c', border:'#e8c87a' },
      'PCA0099':  { lat:50.72, lng:23.54,  id:'maslomecz',   era:'Kansainvaellusaika',type:'sample', color:'#c9a84c', border:'#e8c87a' },
      'VK51':     { lat:57.63, lng:18.29,  id:'gotland',     era:'Viikinkiaika',      type:'sample', color:'#c9a84c', border:'#e8c87a' },
      'VK50':     { lat:57.63, lng:18.31,  id:'gotland2',    era:'Viikinkiaika',      type:'sample', color:'#c9a84c', border:'#e8c87a' },
      'Barcin_N': { lat:40.1,  lng:29.2,   id:'anatolia',    era:'Neoliitti',         type:'sample', color:'#c9a84c', border:'#e8c87a' },
    };

    const apiStops = json.samples
      .filter(s => COORD[s.sample_id])
      .map(s => {
        const c = COORD[s.sample_id];
        return {
          id: c.id, type: c.type,
          site: s.site, region: s.region,
          lat: c.lat, lng: c.lng,
          date_bp: s.date_bp,
          date_label: `~${s.date_bp.toLocaleString('fi')} BP`,
          era: c.era, culture: s.culture,
          sample_id: s.sample_id,
          desc: `NÃ¤yte ${s.sample_id} Â· ${s.culture} Â· ${s.site}`,
          doi: s.doi,
          color: c.color, border: c.border
        };
      })
      .sort((a,b) => b.date_bp - a.date_bp);

    // LisÃ¤Ã¤ refugio + nykyinen kantaja jotka eivÃ¤t ole API:ssa
    const merged = [FALLBACK[0], ...apiStops, FALLBACK[5]];
    status.textContent = `âœ¦ ${json.sample_count} nÃ¤ytettÃ¤ ladattu`;
    setTimeout(() => { status.textContent = ''; }, 3000);
    return merged;

  } catch(e) {
    status.textContent = ''; // nÃ¤ytetÃ¤Ã¤n fallback-data hiljaa
    return FALLBACK;
  }
}

// â”€â”€ KARTTA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const map = L.map('map', { center:[50,15], zoom:4, zoomControl:true });

L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
  attribution:'&copy; <a href="https://stadiamaps.com/">Stadia</a> &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="https://www.openstreetmap.org/copyright">OSM</a>',
  maxZoom:18
}).addTo(map);

// â”€â”€ RAKENNA KARTTA + AIKAJANA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async function build() {
  const stops = await loadData();

  // Reittilinja
  const route = stops.map(s => [s.lat, s.lng]);
  L.polyline(route, { color:'#c9a84c', weight:1.4, opacity:.45, dashArray:'5 6' }).addTo(map);

  const markers = {};
  const tl = document.getElementById('timeline');

  stops.forEach((s, i) => {
    // Markeri
    const m = L.circleMarker([s.lat, s.lng], {
      radius: s.type === 'origin' ? 9 : s.type === 'modern' ? 8 : 10,
      fillColor: s.color, color: s.border,
      weight:1.5, opacity:1, fillOpacity:.88
    }).addTo(map);

    m.bindPopup(`
      <div class="p-body">
        <div class="p-era">${s.era}</div>
        <div class="p-site">${s.site}</div>
        <div class="p-date">${s.date_label}</div>
        ${s.sample_id ? `<div class="p-badge">${s.sample_id}</div>` : ''}
        <div class="p-desc">${s.desc}</div>
        <div class="p-doi">${s.doi}</div>
      </div>`, { maxWidth:280 });

    m.on('click', () => activate(s.id));
    markers[s.id] = m;

    // Aikajana-piste
    const div = document.createElement('div');
    div.className = 'stop';
    div.id = `tl-${s.id}`;
    div.innerHTML = `
      <div class="spine">
        <div class="dot"></div>
        ${i < stops.length-1 ? '<div class="sline"></div>' : ''}
      </div>
      <div class="sbody">
        <div class="sbp">${s.date_label}</div>
        <div class="sname">${s.site}</div>
        <div class="sculture">${s.culture}</div>
        ${s.sample_id ? `<div class="ssample">${s.sample_id}</div>` : ''}
      </div>`;

    div.addEventListener('click', () => {
      map.setView([s.lat, s.lng], 6, { animate:true, duration:.8 });
      markers[s.id].openPopup();
      activate(s.id);
    });

    tl.appendChild(div);
  });

  function activate(id) {
    document.querySelectorAll('.stop').forEach(el => el.classList.remove('active'));
    const el = document.getElementById(`tl-${id}`);
    if (el) { el.classList.add('active'); el.scrollIntoView({ behavior:'smooth', block:'nearest' }); }
  }
}

build();
</script>
</body>
</html>
